service:
  id: rekipe.ingredient
  name: rekipe-ingredient-service
  description: Microservice de gestion des ingr√©dients pour Rekipe
  version: 1.0.1
  guarantees:
    coverage_min: 80
    typing: partial
    security_scanned: true
    ci_enforced: true
  runtime:
    language: python
    version: "3.13"
  data:
    inputs:
      - name: ingredient
        type: payload
        format: json
  capabilities:
    - ingredient.create
    - ingredient.get
    - ingredient.list

docker:
  image: rekipe/ingredient-service
  base_image: python:3.13-slim
  configuration:
    fastapi:
      - API_HOST
      - API_PORT

    rabbitmq:
      - RABBITMQ_HOST
      - RABBITMQ_PORT
      - RABBITMQ_EXCHANGE_NAME
      - RABBITMQ_QUEUE_COMMANDS
      - RABBITMQ_QUEUE_EVENTS

interfaces:
  api:
    technology: fastapi
    port: input
    enabled: true
    base_path: /ingredient/v1
    endpoints:
      - method: POST
        path: /
        summary: Create ingredient
        status_code: 201

      - method: GET
        path: /{name}
        summary: Get ingredient by name
        status_code: 200

      - method: GET
        path: /
        summary: List all ingredients
        status_code: 200

      - method: GET
        path: /health
        summary: Health check
        status_code: 200

  cli:
    technology: shell
    port: input
    enabled: true
    commands:
      - name: create
      - name: get
      - name: list

  message:
    technology: rabbitmq
    port: input
    enabled: true
    exchanges:
      - name: ingredient.exchange
        type: topic
    queues:
      - name: ingredient.commands.queue
      - name: ingredient.events.queue
      - name: ingredient.dlq
    consumes:
      commands:
        - queue: ingredient.commands.queue
          routing_key: ingredient.cmd.#
          supports:
            - ingredient.create
            - ingredient.get
            - ingredient.list
    publishes:
      events:
        - name: ingredient.created
          exchange: ingredient.exchange
          routing_key: ingredient.evt.ingredient.created

        - name: ingredient.updated
          exchange: ingredient.exchange
          routing_key: ingredient.evt.ingredient.updated

  logger:
    technology: logging
    port: output
    enabled: true
    framework: logging

  filesystem:
    technology: local storage
    port: output
    enabled: true
    location: assets/ingredients.csv
